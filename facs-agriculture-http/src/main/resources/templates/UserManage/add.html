<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="../Css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css"
          href="../Css/bootstrap-responsive.css"/>
    <link rel="stylesheet" type="text/css" href="../Css/style.css"/>
    <script type="text/javascript" src="../Js/jquery.js"></script>
    <script type="text/javascript" src="../Js/jquery.sorted.js"></script>
    <script type="text/javascript" src="../Js/bootstrap.js"></script>
    <script type="text/javascript" src="../Js/ckform.js"></script>
    <script type="text/javascript" src="../Js/common.js"></script>
</head>
<style type="text/css">
    body {
        padding-bottom: 40px;
    }

    .sidebar-nav {
        padding: 9px 0;
    }

    @media ( max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
            float: none;
            padding-left: 5px;
            padding-right: 5px;
        }
    }
</style>
<body>
<form action="index.html" method="post" class="definewidth m20">
    <input type="hidden" name="id" value=""/>
    <table class="table table-bordered table-hover ">

        <tr>
            <td>员工工号</td>
            <td><select name="memberId" value="memberId" id="memberId">
                <option th:each="projectmember : ${list}" th:value="${projectmember.id}" th:text="${projectmember.userId}"></option>
            </select>
            </td>
        </tr>


        <tr>
            <td width="10%" class="tableleft">员工姓名</td>
            <td><input type="text" name="name" id="name"/></td>
        </tr>
        <tr>
            <td width="10%" class="tableleft">周数</td>

            <td><span id="show_week"></span></td>
        </tr>
        <tr>
            <td width="10%" class="tableleft">工时分配</td>
            <td><input type="text" name="man_hour" id="manHour"/></td>
        </tr>


        <tr>
            <td class="tableleft">开始时间</td>
            <td>
                <label class='checkbox inline'>
                    <input type="date"  name='date1' value='' id="start_date"/></label>
            </td>
        </tr>
        <tr>
            <td class="tableleft"></td>
            <td>
                <button id="addProject_member_detail" class="btn btn-primary" type="button">保存</button>
                &nbsp;&nbsp;
                <button type="submit" class="btn btn-success" name="backid"
                        id="backid">返回列表
                </button>
            </td>

        </tr>
    </table>
</form>
</body>
</html>
<script  th:inline="javascript">
    $(function () {
        $("#addProject_member_detail").click(function () {

            alert($("#show_week").html());

            ///document.getElementById("show_week").value=week;

            var member_id = $("#memberId").val();
            var name = $("#name").val();
            var week = $("#show_week").html();
            var man_hour = $("#manHour").val();
            var start_date = $("#startDate").val();
            var param={};

            param["memberId"]=member_id;
            param["name"]=name;
            param["week"]=week;
            param["manHour"]=man_hour;
            param["startDate"]=start_date;

            $.ajax({
                url:"/projectmemberdetail/create",
                type:"POST",
                contentType: "application/json; charset=utf-8",
                data:JSON.stringify(param),
                dataType:"json",
                success:function(data){
                    if(data.status==0)
                        window.location.href="/projectmemberdetail/index";
                }
            });
        });

        $("#backid").click(function(){
            window.location.href="/projectmemberdetail/index";
        });
    });

    $("#start_date").change(function() {
        var value = $(this).val();
        var vals = value.split("-");
        var weekNum = weekOfYear(vals[0], vals[1], vals[2]);

        alert(typeof(weekNum));
        $("#show_week").text(weekNum);

    });

    //  计算日期为当年的第几周
    function weekOfYear(year, month, day) {
        //   year       年
        //   month     月
        //   day         日
        //   每周从周日开始
        var date1 = new Date(year, 0, 1);
        var date2 = new Date(year, month - 1, day, 1);
        var dayMS = 24 * 60 * 60 * 1000;
        var firstDay = (7 - date1.getDay()) * dayMS;
        var weekMS = 7 * dayMS;
        date1 = date1.getTime();
        date2 = date2.getTime();
        return Math.ceil((date2 - date1 - firstDay) / weekMS) + 1;
    }

</script>